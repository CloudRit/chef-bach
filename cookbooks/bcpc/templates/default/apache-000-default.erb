################################################
#
#              Generated by Chef
#
################################################

<VirtualHost <%="#{node[:bcpc][:management][:ip]}"%>:80>
    ServerAdmin webmaster@localhost

    DocumentRoot /var/www
    <Directory />
            Options FollowSymLinks
            AllowOverride None
    </Directory>
    <Directory /var/www/>
            Options Indexes FollowSymLinks MultiViews
            AllowOverride None
            Order allow,deny
            allow from all
    </Directory>

    ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
    <Directory "/usr/lib/cgi-bin">
            AllowOverride None
            Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
            Order allow,deny
            Allow from all
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/error.log

    # Possible values include: debug, info, notice, warn, error, crit,
    # alert, emerg.
    LogLevel warn

    CustomLog ${APACHE_LOG_DIR}/access.log combined

    ProxyPass /rabbitmq/ http://<%="#{node[:bcpc][:management][:vip]}"%>:55672/
    ProxyPassReverse /rabbitmq/ http://<%="#{node[:bcpc][:management][:vip]}"%>:55672/
    ProxyPass /elasticsearch/ http://<%="#{node[:bcpc][:management][:vip]}"%>:9200/
    ProxyPassReverse /elasticsearch/ http://<%="#{node[:bcpc][:management][:vip]}"%>:9200/
    ProxyPass /kibana/ http://<%="#{node[:bcpc][:management][:vip]}"%>:5601/
    ProxyPassReverse /kibana/ http://<%="#{node[:bcpc][:management][:vip]}"%>:5601/
    ProxyPass /haproxy/ http://<%="#{node[:bcpc][:management][:vip]}"%>:1936/
    ProxyPassReverse /haproxy/ http://<%="#{node[:bcpc][:management][:vip]}"%>:1936/

    Redirect permanent /graphite https://<%="#{node[:bcpc][:management][:vip]}"%>:8888
    Redirect permanent /horizon https://<%="#{node[:bcpc][:management][:vip]}"%>/horizon
    Redirect permanent /phpmyadmin https://<%="#{node[:bcpc][:management][:vip]}"%>/phpmyadmin
    Redirect permanent /phpldapadmin https://<%="#{node[:bcpc][:management][:vip]}"%>/phpldapadmin
</VirtualHost>

<VirtualHost <%="#{node[:bcpc][:management][:ip]}"%>:443>
    DocumentRoot "/var/www"
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/ssl-bcpc.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-bcpc.key
</VirtualHost>
